(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13],{3308:function(e,l,t){Promise.resolve().then(t.bind(t,684))},684:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return Home}});var s=t(7437),a=t(2265),r=t(3753),n=t(6691),i=t.n(n);let c=(0,s.jsx)("path",{d:"M19.8 4.2a1 1 0 1 0-1.4-1.4L12 10.6 5.6 4.2a1 1 0 1 0-1.4 1.4L10.6 12l-6.4 6.4a1 1 0 1 0 1.4 1.4L12 13.4l6.4 6.4a1 1 0 1 0 1.4-1.4L13.4 12l6.4-6.4z"}),o=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),(0,s.jsx)("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]}),d=(0,s.jsx)("path",{d:"M14.7928932,11.5 L11.6464466,8.35355339 C11.4511845,8.15829124 11.4511845,7.84170876 11.6464466,7.64644661 C11.8417088,7.45118446 12.1582912,7.45118446 12.3535534,7.64644661 L16.3535534,11.6464466 C16.5488155,11.8417088 16.5488155,12.1582912 16.3535534,12.3535534 L12.3535534,16.3535534 C12.1582912,16.5488155 11.8417088,16.5488155 11.6464466,16.3535534 C11.4511845,16.1582912 11.4511845,15.8417088 11.6464466,15.6464466 L14.7928932,12.5 L4,12.5 C3.72385763,12.5 3.5,12.2761424 3.5,12 C3.5,11.7238576 3.72385763,11.5 4,11.5 L14.7928932,11.5 Z M16,4.5 C15.7238576,4.5 15.5,4.27614237 15.5,4 C15.5,3.72385763 15.7238576,3.5 16,3.5 L19,3.5 C20.3807119,3.5 21.5,4.61928813 21.5,6 L21.5,18 C21.5,19.3807119 20.3807119,20.5 19,20.5 L16,20.5 C15.7238576,20.5 15.5,20.2761424 15.5,20 C15.5,19.7238576 15.7238576,19.5 16,19.5 L19,19.5 C19.8284271,19.5 20.5,18.8284271 20.5,18 L20.5,6 C20.5,5.17157288 19.8284271,4.5 19,4.5 L16,4.5 Z",transform:"rotate(90 12.5 12)"}),m=(0,s.jsx)("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"}),x=(0,s.jsx)("path",{d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"});var h={close:{viewBox:"0 0 24 24",scale:.8,path:c,fill:!0,stroke:2},copy:{viewBox:"0 0 24 24",scale:.8,path:o,fill:!1,stroke:2},download:{viewBox:"0 0 24 24",scale:.9,path:d,fill:!0,stroke:.8},settings:{viewBox:"0 0 16 16",scale:.8,path:m,fill:!1,stroke:!0},upload:{viewBox:"0 0 24 24",scale:.9,path:x,fill:!1,stroke:2}},icon=e=>{let{name:l,size:t=20,color:a,onClick:r}=e,n=h[l]||{},i=n.scale||1;return(0,s.jsx)("div",{style:{color:a},onClick:r,children:(0,s.jsx)("svg",{width:t*i,height:t*i,strokeWidth:n.stroke&&0!==n.stroke?"".concat(n.stroke):"1.5",stroke:!1===n.stroke||0===n.stroke?"transparent":"currentColor",strokeLinecap:"round",strokeLinejoin:"round",fill:n.fill?"currentColor":"transparent",viewBox:n.viewBox||"0 0 32 32",children:n.path})})},components_Navbar=e=>{let{logo:l,name:t}=e;return(0,s.jsxs)("div",{className:"fixed w-full flex items-center justify-between h-12 shadow-md",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center space-x-10 ml-6",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center space-x-2",children:[(0,s.jsx)(i(),{src:l,alt:"SQLGen",width:"24",height:"24"}),(0,s.jsx)("span",{children:t})]}),(0,s.jsx)("div",{className:"flex flex-row items-center space-x-4"})]}),(0,s.jsxs)("div",{className:"flex flex-row items-center space-x-2 mr-6",children:[(0,s.jsx)(icon,{name:"download"}),(0,s.jsx)(icon,{name:"settings"})]})]})},components_Upload=e=>{let{onProcess:l}=e,handleUpload=async e=>{var t;e.preventDefault();let s=null===(t=e.target.files)||void 0===t?void 0:t[0];await l(s),e.target.value=""};return(0,s.jsxs)("label",{htmlFor:"dropzone-file",className:"mx-auto cursor-pointer flex w-full max-w-lg flex-col items-center rounded-xl border-2 border-dashed border-blue-400 bg-white p-6 text-center",children:[(0,s.jsx)(icon,{name:"upload",size:32,color:"#057bff"}),(0,s.jsx)("h2",{className:"mt-4 text-xl font-medium text-gray-700 tracking-wide",children:"XMind File"}),(0,s.jsx)("p",{className:"mt-2 text-gray-500 tracking-wide",children:"Click and upload your xmind file here."}),(0,s.jsx)("input",{id:"dropzone-file",type:"file",className:"hidden",onChange:handleUpload})]})},f=t(3152),u=t(4042);t(2995),f.Z.registerLanguage("javascript",u.Z);var code=e=>{let{lang:l,code:t}=e,r=(0,a.useRef)(null);return(0,a.useEffect)(()=>{r.current&&f.Z.highlightBlock(r.current)},[t]),(0,s.jsxs)("div",{className:"border rounded-md",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center justify-between rounded-t-md text-xs text-gray-200 bg-gray-800 px-4 py-2",children:[(0,s.jsx)("div",{className:"",children:l}),(0,s.jsxs)("button",{className:"flex flex-row space-x-1 rounded-md px-2",onClick:()=>{let e=r.current;if(e){let l=document.createRange();l.selectNodeContents(e);let t=window.getSelection();null==t||t.removeAllRanges(),null==t||t.addRange(l),document.execCommand("copy")}},children:[(0,s.jsx)(icon,{name:"copy"})," ",(0,s.jsx)("span",{children:"Copy code"})]})]}),(0,s.jsx)("pre",{className:"",children:(0,s.jsx)("code",{ref:r,className:"rounded-b-md ".concat(l),children:t})})]})},tabs=e=>{let{prefix:l,defaultActiveKey:t,items:r,buttons:n,onSelectTab:i}=e,[c,o]=(0,a.useState)(t),d={borderBottom:"white",color:"#1890FF",fontWeight:"bold",background:"white"},m=r.find(e=>e.key===c),onSelectTabItem=(e,l)=>{o(e),i&&i(l)};return(0,s.jsxs)("div",{className:"h-full w-full flex flex-col justify-start",children:[(0,s.jsxs)("div",{className:"flex flex-row z-10 justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-row",children:[l&&(0,s.jsx)("div",{className:"mb-[-1px] px-3 py-2 border border-solid border-[#1890FF] font-bold text-white bg-[#1890FF]",children:l},"prefix"),r.map((e,l)=>(0,s.jsx)("div",{className:"mb-[-1px] ml-[-1px] first:ml-[0px] px-3 py-1 text-sm border border-solid border-gray-300 ".concat(r.length>1?"first:border-r-0":""," bg-gray-100 cursor-pointer"),style:e.key===c?d:{},onClick:()=>onSelectTabItem(e.key,l),children:e.label},e.key))]}),(0,s.jsx)("div",{className:"flex flex-row items-center space-x-2",children:null==n?void 0:n.map((e,l)=>(0,s.jsx)("div",{children:e},l))})]}),(0,s.jsx)("div",{className:"bg-white border border-solid border-gray-300 overflow-y-auto",style:{height:"calc(100% - 70px)"},children:null==m?void 0:m.children})]})},copyright=e=>{let{company:l}=e;return(0,s.jsx)("div",{className:"w-full h-40 flex items-center justify-center bottom-0 border-t border-t-gray-100",children:(0,s.jsxs)("div",{className:"text-gray-400",children:["\xa9 ",new Date().getFullYear()," ",l]})})},p=t(4436);let read=async e=>{try{var l;let t=new p.Mr(new p.Nt(e)),s=await t.getEntries(),a=s.find(e=>"content.json"===e.filename),r=await (null==a?void 0:null===(l=a.getData)||void 0===l?void 0:l.call(a,new p.Ek));return r?JSON.parse(r):void 0}catch(e){return}},genSql=e=>{let l=[],t=splitTree(e.item);return t.forEach(e=>{l.push(genSqlForTable(e))}),l},splitTree=e=>{let l=[];return e.children&&e.children.length>0&&e.isMultiple&&l.push(e),e.children&&e.children.forEach(e=>{let t=splitTree(e);l.push(...t)}),l},g="PARENT",genSqlForTable=e=>{let l={item:e,columns:[],tables:[],joins:[],conditions:[]};processParentRelationship(e,l),pushIfNotExists(l.columns,getColumnsOfItem(e,!0));let t=fixColumns(l.columns,e);return l.columns=t,dfs(e,l),result2sql(l)},fixColumns=(e,l)=>{let t=getAliasOrName(l);return e.includes("".concat(t,".*"))?e.filter(e=>!e.startsWith("".concat(t,"."))||e==="".concat(t,".*")):e},getColumnsOfItem=(e,l)=>e.children?e.children.filter(e=>!e.children).map(l=>"".concat(getAliasOrName(e),".").concat(getAliasOrName(l))):l?["".concat(getAliasOrName(e),".*")]:[],refs2conditions=(e,l,t)=>e.map(e=>{let s=-1!==e[1].indexOf(".")?e[1]:"".concat(t,".").concat(e[1]);return"".concat(l,".").concat(e[0]," = ").concat(s)}),processParentRelationship=(e,l)=>{let{columns:t,tables:s,conditions:a}=l;if(e.refs&&e.refs.length>0){s.push("___DUMMY___ ".concat(g));let l=refs2conditions(e.refs,g,getAliasOrName(e));pushIfNotExists(a,l);let r=refs2columns(e.refs,getAliasOrName(e));pushIfNotExists(t,r)}},refs2columns=(e,l)=>e.map(e=>{let t=-1!==e[1].indexOf(".")?e[1]:"".concat(l,".").concat(e[1]);return"".concat(t)}),dfs=(e,l)=>{if(!e.children)return;pushIfNotExists(l.columns,getColumnsOfItem(e));let t=e.children.filter(e=>e.children);t.forEach(t=>{if(!t.isMultiple){if(t.refs&&t.refs.length>0){let s=refs2conditions(t.refs,getAliasOrName(e),getAliasOrName(t)),a="LEFT JOIN ".concat(getTableAndAlias(t)," ON ").concat(s.join(" AND "));l.joins.push(a)}else l.tables.push(getTableAndAlias(t));dfs(t,l)}})},result2sql=e=>{let{item:l,columns:t,tables:s,joins:a,conditions:r}=e,n=t.join(", "),i=["".concat(getTableAndAlias(l)," ").concat(a.join(" ")),...s].join(", "),c=r.length>0?"WHERE ".concat(r.join(" AND ")):"",o="SELECT ".concat(n," FROM ").concat(i," ").concat(c);return o.replace(/\s+/g," ").replace(/\s+,\s+/g,", ").trim()},getAliasOrName=e=>e.alias||e.name,getTableAndAlias=e=>e.alias?"".concat(e.name," ").concat(e.alias):e.name,pushIfNotExists=(e,l)=>{l.forEach(l=>{e.includes(l)||e.push(l)})},topic2item=e=>{let l=e.id,t={id:l,name:""},s=e.title.indexOf("/");-1===s?t.name=e.title:(t.name=e.title.substring(0,s).trim(),t.comment=e.title.substring(s+1).trim()),t.name=t.name.replaceAll(" ",""),t.name.endsWith("[]")&&(t.name=t.name.substring(0,t.name.length-2),t.isMultiple=!0);let a=/(.*)\((.*)\)/.exec(t.name);a&&(""!==a[1]&&(t.name=a[1]),""!==a[2]&&(t.alias=a[2])),e.labels&&(t.refs=e.labels.map(e=>{let l=e.replace(" ",""),t=l.split("=");return 2===t.length?t:[t[0],t[0]]}));let r=parseChildrenTopics(e);return r&&r.length>0&&(t.children=r),t},parseChildrenTopics=e=>{var l;if(!(null===(l=e.children)||void 0===l?void 0:l.attached))return;let t=[];return e.children.attached.forEach(e=>{let l=topic2item(e);t.push(l)}),t},parse=async e=>{if(!e)return{code:-1,message:"file is null"};let l=await read(e),t=null==l?void 0:l.map(e=>{let l={id:e.id,name:e.title,item:topic2item(e.rootTopic)},t=genSql(l);return{business:l,sqls:t}});return t?{code:0,message:"success",result:t,filename:e.name}:{code:-2,message:"Failed reading from xmind! Not a Xmind file?"}};function Modal(e){let{title:l,onClose:t,children:a,actions:r}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 right-0 bottom-0 z-50 bg-black opacity-70"}),(0,s.jsx)("div",{className:"absolute top-0 left-0 z-50 w-screen h-screen flex justify-center items-center",children:(0,s.jsxs)("div",{className:"w-3/4 flex flex-col border shadow-md bg-white rounded-lg p-2 overflow-auto",style:{maxWidth:"80%",maxHeight:"90%"},children:[(0,s.jsxs)("div",{className:"min-w-96 flex items-center justify-between border-b border-b-gray-300 p-2",children:[(0,s.jsx)("div",{className:"font-bold text-gray-900 text-base",children:l}),(0,s.jsx)("div",{className:"cursor-pointer hover:brightness-125",onClick:t,children:(0,s.jsx)(icon,{name:"close",color:"#000000"})})]}),(0,s.jsx)("div",{className:"p-2 overflow-auto",children:a}),r&&r.length>0&&(0,s.jsx)("div",{className:"w-full flex justify-center border-t border-t-gray-300 p-2 pt-4",children:(0,s.jsx)("div",{className:"flex items-center",children:null==r?void 0:r.map((e,l)=>(0,s.jsx)("div",{className:"!last:mr-20",children:e},l))})})]})})]})}function Home(){var e;let[l,t]=(0,a.useState)(),[n,i]=(0,a.useState)(!0),[c,o]=(0,a.useState)([]),onProcess=async e=>{if(!e){alert("No file selected");return}let l=await parse(e);l.code>=0&&(t(l),i(!0))};return(0,a.useEffect)(()=>{if((null==l?void 0:l.code)===0){var e;let t=[];null===(e=l.result)||void 0===e||e.forEach((e,l)=>{let{business:a,sqls:n}=e,i={label:a.name,key:l.toString(),children:(0,s.jsx)("div",{className:"px-4 py-2",children:n.map((e,l)=>(0,s.jsx)("div",{className:"my-2",children:(0,s.jsx)(code,{lang:"sql",code:(0,r.WU)(e)})},l))})};t.push(i)}),o(t)}},[l]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("main",{className:"w-full flex flex-col items-center",style:{height:"calc(100vh - 24px)"},children:[(0,s.jsx)(components_Navbar,{logo:"/sqlgen.png",name:"SQLGen"}),(0,s.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center pt-10 pb-24",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center mb-16 space-y-2 cursor-default",children:[(0,s.jsxs)("h1",{className:"font-bold text-7xl",children:[(0,s.jsx)("span",{className:"text-[#057bff]",children:"SQL"}),(0,s.jsx)("span",{className:"text-[#ff9102]",children:"Gen"}),(0,s.jsx)("span",{className:"text-4xl text-gray-400",children:" with"}),(0,s.jsx)("span",{className:"text-4xl",children:" Mindmap"})]}),(0,s.jsx)("span",{className:"text-xl text-thin text-gray-400",children:"for extracting data from Database"})]}),(0,s.jsx)(components_Upload,{onProcess:onProcess})]}),(0,s.jsx)(copyright,{company:"军事医学研究院"})]}),n&&l&&(0,s.jsx)(Modal,{title:null!==(e=null==l?void 0:l.filename)&&void 0!==e?e:"",onClose:()=>i(!1),children:(0,s.jsx)(tabs,{defaultActiveKey:"0",items:c})})]})}t(4040)}},function(e){e.O(0,[413,222,971,472,744],function(){return e(e.s=3308)}),_N_E=e.O()}]);